

<!DOCTYPE html>
<html class="writer-html5" lang="de" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>1.49. Festplattenverschlüsselung mit NetBSD &mdash; BSDForen.de 1.0 Dokumentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Stichwortverzeichnis" href="../genindex.html" />
    <link rel="search" title="Suche" href="../search.html" />
    <link rel="next" title="1.50. Festplattenverschlüsselung mit pefs" href="festplattenverschluesselung_mit_pefs.txt.html" />
    <link rel="prev" title="1.48. Festplattenverschlüsselung mit Geli und USB Boot" href="festplattenverschluesselung_mit_geli_und_usb_boot.txt.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> BSDForen.de
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Dokumentation durchsuchen" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="howto_index.html">1. Howto</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="3d-grafik-beschleunigung.txt.html">1.1. 3D-Grafik-Beschleunigung</a></li>
<li class="toctree-l2"><a class="reference internal" href="anschluss_an_das_internet_mit_pppoe_mpd_und_firewall_pf.txt.html">1.2. Anschluss an das Internet mit PPPoe (mpd) und Firewall (pf)</a></li>
<li class="toctree-l2"><a class="reference internal" href="apache_mit_php5_installieren.txt.html">1.3. Apache mit php5 installieren</a></li>
<li class="toctree-l2"><a class="reference internal" href="asterisk_voip_telefonanalge.txt.html">1.4. Asterisk</a></li>
<li class="toctree-l2"><a class="reference internal" href="audio-cd_rippen.txt.html">1.5. Audio-CD rippen</a></li>
<li class="toctree-l2"><a class="reference internal" href="aufloesung_der_konsole_aendern.txt.html">1.6. Auflösung der Konsole ändern</a></li>
<li class="toctree-l2"><a class="reference internal" href="authpf.txt.html">1.7. authpf</a></li>
<li class="toctree-l2"><a class="reference internal" href="autologin_auf_der_konsole.txt.html">1.8. Autologin auf der Konsole</a></li>
<li class="toctree-l2"><a class="reference internal" href="automatische_proxy-konfiguration.txt.html">1.9. Automatische Proxy-Konfiguration</a></li>
<li class="toctree-l2"><a class="reference internal" href="automatisches_beenden_von_diensten.txt.html">1.10. Automatisches Beenden von Diensten</a></li>
<li class="toctree-l2"><a class="reference internal" href="automount.txt.html">1.11. Automount</a></li>
<li class="toctree-l2"><a class="reference internal" href="awk.txt.html">1.12. AWK</a></li>
<li class="toctree-l2"><a class="reference internal" href="backup_auf_cd-r.txt.html">1.13. Backup auf CD-R</a></li>
<li class="toctree-l2"><a class="reference internal" href="backup_mit_hammer.txt.html">1.14. Backup mit HAMMER</a></li>
<li class="toctree-l2"><a class="reference internal" href="backup_ueber_das_netzwerk.txt.html">1.15. Backup über das Netzwerk</a></li>
<li class="toctree-l2"><a class="reference internal" href="batterieueberwachung.txt.html">1.16. Batterieüberwachung</a></li>
<li class="toctree-l2"><a class="reference internal" href="beseitigen_von_problemen_und_fehlern.txt.html">1.17. Beseitigen von Problemen und Fehlern</a></li>
<li class="toctree-l2"><a class="reference internal" href="bluetooth.txt.html">1.18. Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="bootvorgang_verschoenern.txt.html">1.19. Bootvorgang verschönern/verkürzen</a></li>
<li class="toctree-l2"><a class="reference internal" href="canon_eos_1100d_mit_gphoto_und_gimp_betreiben.txt.html">1.20. Verwendung einer Canon EOS 1100D mit Gimp im Tethering Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="cd_iso_to_usb.txt.html">1.21. FreeBSD CD-ISO in USB Stick Image umwandeln</a></li>
<li class="toctree-l2"><a class="reference internal" href="chinesisch_schreiben.txt.html">1.22. Chinesisch schreiben</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpu_stepping.txt.html">1.23. CPU Stepping (cpufreq, powerd)</a></li>
<li class="toctree-l2"><a class="reference internal" href="crossbuilding_freebsd.txt.html">1.24. Crossbuilding FreeBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="crunchbsd.txt.html">1.25. CrunchBang Desktop</a></li>
<li class="toctree-l2"><a class="reference internal" href="cups_-_drucken_in_heterogener_umgebung.txt.html">1.26. CUPS - Drucken in heterogener Umgebung</a></li>
<li class="toctree-l2"><a class="reference internal" href="cups_-_installation_und_konfiguration.txt.html">1.27. CUPS - Installation und Konfiguration</a></li>
<li class="toctree-l2"><a class="reference internal" href="cups_-_installation_und_konfiguration.txt.html#drucker-einrichten-unter-cups">1.28. Drucker einrichten unter CUPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="datenrettung.txt.html">1.29. Datenrettung</a></li>
<li class="toctree-l2"><a class="reference internal" href="deutsche_sprachausgabe_mit_festival.txt.html">1.30. Deutsche Sprachausgabe mit Festival</a></li>
<li class="toctree-l2"><a class="reference internal" href="deutsche_sprachausgabe_mit_festival.txt.html#kmouth-mit-festival">1.31. KMouth mit Festival</a></li>
<li class="toctree-l2"><a class="reference internal" href="devfs.txt.html">1.32. devfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="dhcp-server_einrichten.txt.html">1.33. DHCP-Server einrichten</a></li>
<li class="toctree-l2"><a class="reference internal" href="dns-cache.txt.html">1.34. DNS-Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="drucken_mit_apsfilter.txt.html">1.35. Drucken mit Apsfilter</a></li>
<li class="toctree-l2"><a class="reference internal" href="drucken_mit_windows.txt.html">1.36. Drucken mit Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="dsl_konfigurieren_netbsd.txt.html">1.37. DSL konfigurieren (NetBSD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="dvb-t_karte_hauppauge_wintv-hvr_1300.txt.html">1.38. DVB-T Karte Hauppauge WinTV-HVR 1300</a></li>
<li class="toctree-l2"><a class="reference internal" href="dvb_unter_freebsd.txt.html">1.39. DVB unter FreeBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="dvd-rip_mit_mencoder.txt.html">1.40. DVD-Rip mit mencoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="dvds_brennen.txt.html">1.41. DVDs brennen</a></li>
<li class="toctree-l2"><a class="reference internal" href="ed2k-protokoll.txt.html">1.42. ed2k-Protokoll beim Mozilla, Seamonkey und Firefox</a></li>
<li class="toctree-l2"><a class="reference internal" href="eigenes_live-system_auf_usb-stick_installieren.txt.html">1.43. Eigenes Live-System auf USB-Stick installieren</a></li>
<li class="toctree-l2"><a class="reference internal" href="externe_projekte.txt.html">1.44. Mail</a></li>
<li class="toctree-l2"><a class="reference internal" href="ezjail.txt.html">1.45. Ezjail</a></li>
<li class="toctree-l2"><a class="reference internal" href="festplatte_einrichten.txt.html">1.46. Festplatte einrichten</a></li>
<li class="toctree-l2"><a class="reference internal" href="festplatte_einrichten_gpt.txt.html">1.47. Manuelle Verwaltung von Festplatten nach neuem GUID Partition Table (GPT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="festplattenverschluesselung_mit_geli_und_usb_boot.txt.html">1.48. Festplattenverschlüsselung mit Geli und USB Boot</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">1.49. Festplattenverschlüsselung mit NetBSD</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#uber">1.49.1. Über</a></li>
<li class="toctree-l3"><a class="reference internal" href="#der-weg">1.49.2. Der Weg</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#anforderungen">1.49.2.1. Anforderungen</a></li>
<li class="toctree-l4"><a class="reference internal" href="#backup">1.49.2.2. Backup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#netbsd-installieren">1.49.2.3. NetBSD installieren</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#weblinks">1.49.3. Weblinks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="festplattenverschluesselung_mit_pefs.txt.html">1.50. Festplattenverschlüsselung mit pefs</a></li>
<li class="toctree-l2"><a class="reference internal" href="film-dvd_erstellen.txt.html">1.51. Film-DVD erstellen</a></li>
<li class="toctree-l2"><a class="reference internal" href="firewall-regeln.txt.html">1.52. Firewall-Regeln</a></li>
<li class="toctree-l2"><a class="reference internal" href="floppy.txt.html">1.53. Floppy</a></li>
<li class="toctree-l2"><a class="reference internal" href="fluxbox_mit_gdm.txt.html">1.54. Fluxbox mit gdm</a></li>
<li class="toctree-l2"><a class="reference internal" href="freebsd_als_gast_unter_vmware.txt.html">1.55. FreeBSD als Gast unter VMware</a></li>
<li class="toctree-l2"><a class="reference internal" href="freebsd_boot_manager_und_vista.txt.html">1.56. FreeBSD Boot Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="ftp-server_mit_pureftpd.txt.html">1.57. FTP-Server mit PureFTPd</a></li>
<li class="toctree-l2"><a class="reference internal" href="gnupg.txt.html">1.58. GnuPG</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpsdrive.txt.html">1.59. GPSDrive</a></li>
<li class="toctree-l2"><a class="reference internal" href="grafikausgabe_im_netzwerk.txt.html">1.60. Grafikausgabe im Netzwerk: X11, XDM und XDMCP</a></li>
<li class="toctree-l2"><a class="reference internal" href="grub2-anleitung.txt.html">1.61. GRUB2-Anleitung</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibm_thinkpad_bios-update.txt.html">1.62. IBM Thinkpad BIOS-Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="intel2200bg.txt.html">1.63. Intel 2200BG</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipsec-vpn.txt.html">1.64. IPSEC-VPN</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipv6_netzwerke.txt.html">1.65. IPv6-Netzwerke mit FreeBSD als Router</a></li>
<li class="toctree-l2"><a class="reference internal" href="irc-protokoll.txt.html">1.66. irc-Protokoll im Mozilla, Seamonkey und Firefox</a></li>
<li class="toctree-l2"><a class="reference internal" href="iso-images_mounten.txt.html">1.67. ISO-Images mounten</a></li>
<li class="toctree-l2"><a class="reference internal" href="iso-images_von_optischen_medien_erzeugen.txt.html">1.68. ISO-Images von optischen Medien erzeugen</a></li>
<li class="toctree-l2"><a class="reference internal" href="jails.txt.html">1.69. Jails</a></li>
<li class="toctree-l2"><a class="reference internal" href="java_installation.txt.html">1.70. Java Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="k3b_einrichten.txt.html">1.71. K3B einrichten</a></li>
<li class="toctree-l2"><a class="reference internal" href="kde4-tipps.txt.html">1.72. KDE4 Tipps</a></li>
<li class="toctree-l2"><a class="reference internal" href="kdm.txt.html">1.73. KDM</a></li>
<li class="toctree-l2"><a class="reference internal" href="kerio_mailserver.txt.html">1.74. Kerio Mailserver</a></li>
<li class="toctree-l2"><a class="reference internal" href="konsole_nach_systemstart_und_logout_loeschen.txt.html">1.75. Konsole nach Systemstart und Logout löschen</a></li>
<li class="toctree-l2"><a class="reference internal" href="kopplung_zweier_stationen_mittels_rfc3378_via_wlan_freebsd.txt.html">1.76. Kopplung zweier Stationen mittels RFC3378 via WLAN (FreeBSD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="m0n0wall_sip.txt.html">1.77. M0n0wall &amp; SIP</a></li>
<li class="toctree-l2"><a class="reference internal" href="mailhamster.txt.html">1.78. Mailhamster (Mailsammler)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mailsystem.txt.html">1.79. Das eigene Mailsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="majordomo_postfix.txt.html">1.80. Majordomo Postfix</a></li>
<li class="toctree-l2"><a class="reference internal" href="make.conf_optimieren.txt.html">1.81. make.conf optimieren</a></li>
<li class="toctree-l2"><a class="reference internal" href="make_world.txt.html">1.82. make world</a></li>
<li class="toctree-l2"><a class="reference internal" href="mehrmonitor-betrieb.txt.html">1.83. Mehrmonitor-Betrieb</a></li>
<li class="toctree-l2"><a class="reference internal" href="mkisofs_und_cdrecord.txt.html">1.84. mkisofs und cdrecord</a></li>
<li class="toctree-l2"><a class="reference internal" href="mounten_als_benutzer.txt.html">1.85. Mounten als Benutzer</a></li>
<li class="toctree-l2"><a class="reference internal" href="moused_einrichten.txt.html">1.86. moused einrichten</a></li>
<li class="toctree-l2"><a class="reference internal" href="mozilla_mit_java-_und_flashsupport.txt.html">1.87. Mozilla mit Java- und Flashsupport</a></li>
<li class="toctree-l2"><a class="reference internal" href="mpd_einrichten.txt.html">1.88. MPD einrichten</a></li>
<li class="toctree-l2"><a class="reference internal" href="mpi.txt.html">1.89. MPI auf FreeBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="multihead_mit_nv.txt.html">1.90. Multihead mit nv</a></li>
<li class="toctree-l2"><a class="reference internal" href="nvidia_twinview.txt.html">1.91. nVidia Twinview</a></li>
<li class="toctree-l2"><a class="reference internal" href="openbsd_raspberry4_installieren.txt.html">1.92. OpenBSD 6.7 auf dem RaspberryPI 4 installieren</a></li>
<li class="toctree-l2"><a class="reference internal" href="openoffice_unter_freebsd.txt.html">1.93. OpenOffice unter FreeBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="openvpn_als_tunnel_zum_eigenen_netzwerk.txt.html">1.94. OpenVPN als Tunnel zum eigenen Netzwerk</a></li>
<li class="toctree-l2"><a class="reference internal" href="pakete_deinstallieren.txt.html">1.95. Pakete deinstallieren</a></li>
<li class="toctree-l2"><a class="reference internal" href="paketsysteme.txt.html">1.96. Paketsysteme</a></li>
<li class="toctree-l2"><a class="reference internal" href="partitionierung.txt.html">1.97. Festplattenpartitionierung unter FreeBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="pkg.txt.html">1.98. pkg</a></li>
<li class="toctree-l2"><a class="reference internal" href="postfix_antivirus.txt.html">1.99. Postfix Antivirus</a></li>
<li class="toctree-l2"><a class="reference internal" href="postfix_courier_openldap.txt.html">1.100. Postfix Courier OpenLDAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="postfix_dspam.txt.html">1.101. Postfix DSPAM</a></li>
<li class="toctree-l2"><a class="reference internal" href="postgresql_update.txt.html">1.102. PostgreSQL Update auf einen neueren Zweig</a></li>
<li class="toctree-l2"><a class="reference internal" href="poudriere.txt.html">1.103. Poudriere</a></li>
<li class="toctree-l2"><a class="reference internal" href="poudriere_guide.txt.html">1.104. Poudriere Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="putty.txt.html">1.105. PuTTY</a></li>
<li class="toctree-l2"><a class="reference internal" href="remount_rw.txt.html">1.106. Remount RW Read/Write</a></li>
<li class="toctree-l2"><a class="reference internal" href="revision_control_system.txt.html">1.107. Revision Control System</a></li>
<li class="toctree-l2"><a class="reference internal" href="runit.txt.html">1.108. runit auf FreeBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="samsung_smt_7020s.txt.html">1.109. Samsung SMT-7020S</a></li>
<li class="toctree-l2"><a class="reference internal" href="scharfe_windows_schriften.txt.html">1.110. scharfe Windows Schriften</a></li>
<li class="toctree-l2"><a class="reference internal" href="schoene_schriften_in_xorg.txt.html">1.111. Schöne Schriften in Xorg</a></li>
<li class="toctree-l2"><a class="reference internal" href="shell-scripting.txt.html">1.112. Shell-Scripting</a></li>
<li class="toctree-l2"><a class="reference internal" href="soundkarte_einrichten.txt.html">1.113. Soundkarte einrichten</a></li>
<li class="toctree-l2"><a class="reference internal" href="speaker_deaktivieren.txt.html">1.114. PC-Speaker deaktivieren</a></li>
<li class="toctree-l2"><a class="reference internal" href="ssh.txt.html">1.115. ssh</a></li>
<li class="toctree-l2"><a class="reference internal" href="suspend_resume_thinkpad.txt.html">1.116. Suspend und Resume bei Thinkpads</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_in_raid1_verwandeln.txt.html">1.117. System in RAID1 verwandeln</a></li>
<li class="toctree-l2"><a class="reference internal" href="systemueberwachung.txt.html">1.118. Systemüberwachung</a></li>
<li class="toctree-l2"><a class="reference internal" href="texlive_aus_den_quellen.txt.html">1.119. TeXlive aus dem Quellcode installieren</a></li>
<li class="toctree-l2"><a class="reference internal" href="tomcat_6_installation_und_stolpersteine.txt.html">1.120. Tomcat 6 Installation und Stolpersteine</a></li>
<li class="toctree-l2"><a class="reference internal" href="tor.txt.html">1.121. Tor (OpenBSD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="tor_und_privoxy.txt.html">1.122. Tor und Privoxy</a></li>
<li class="toctree-l2"><a class="reference internal" href="tortoise-like_svn_menu_in_nautilus_mit_rabbitcvs.txt.html">1.123. Tortoise like SVN Menu in Nautilus</a></li>
<li class="toctree-l2"><a class="reference internal" href="tv-karte_benutzen.txt.html">1.124. TV-Karte benutzen</a></li>
<li class="toctree-l2"><a class="reference internal" href="twinview_mit_nvidia.txt.html">1.125. TwinView mit dem nVidia-Treiber für FreeBSD, Linux und Solaris</a></li>
<li class="toctree-l2"><a class="reference internal" href="umts.txt.html">1.126. UMTS</a></li>
<li class="toctree-l2"><a class="reference internal" href="umts_mit_huawei.txt.html">1.127. UMTS mit HUAWEI</a></li>
<li class="toctree-l2"><a class="reference internal" href="umts_mit_sunrise_und_swisscom.txt.html">1.128. UMTS mit Sunrise und Swisscom</a></li>
<li class="toctree-l2"><a class="reference internal" href="unicode.txt.html">1.129. UNICODE</a></li>
<li class="toctree-l2"><a class="reference internal" href="unicode_auf_der_konsole.txt.html">1.130. Unicode auf der Konsole</a></li>
<li class="toctree-l2"><a class="reference internal" href="unix-freigabe.txt.html">1.131. Unix-Freigabe</a></li>
<li class="toctree-l2"><a class="reference internal" href="updaten_von_openbsd.txt.html">1.132. Updaten von OpenBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="usb-stick_als_system-laufwerk_nutzen_mit_netbsd_livekey.txt.html">1.133. USB-Stick als System-Laufwerk nutzen mit „NetBSD LiveKey“</a></li>
<li class="toctree-l2"><a class="reference internal" href="usb-stick_installation.txt.html">1.134. USB-Stick Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="usb-stick_unterstuetzung.txt.html">1.135. USB-Stick Unterstützung</a></li>
<li class="toctree-l2"><a class="reference internal" href="usb_automount_ohne_hal.txt.html">1.136. USB Automount ohne HAL</a></li>
<li class="toctree-l2"><a class="reference internal" href="vdsl_mit_openbsd.txt.html">1.137. VDSL and OpenBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="vlans_mit_freebsd.txt.html">1.138. VLAN-Konfiguration mit FreeBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="vpn_openbsd.txt.html">1.139. VPN (OpenBSD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="windowmanager.txt.html">1.140. Windowmanager</a></li>
<li class="toctree-l2"><a class="reference internal" href="windows-freigabe.txt.html">1.141. Windows-Freigabe</a></li>
<li class="toctree-l2"><a class="reference internal" href="wine.txt.html">1.142. Wine</a></li>
<li class="toctree-l2"><a class="reference internal" href="xfce4_mit_gdm.txt.html">1.143. Xfce4 mit gdm</a></li>
<li class="toctree-l2"><a class="reference internal" href="xmodmap.txt.html">1.144. Xmodmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="xorg_config.txt.html">1.145. Xorg Konfigurieren</a></li>
<li class="toctree-l2"><a class="reference internal" href="zeit_synchronisieren_mit_ntp.txt.html">1.146. Zeit synchronisieren mit ntp</a></li>
<li class="toctree-l2"><a class="reference internal" href="zfs.txt.html">1.147. ZFS auf FreeBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="zfs_geli_und_usb_boot.txt.html">1.148. ZFS (raidz), Geli und USB Boot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../anwendungen/anwendungen_index.html">2. Anwendungen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hardware/hardware_index.html">3. Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spiele/spiele_index.html">4. Spiele</a></li>
<li class="toctree-l1"><a class="reference internal" href="../freebsd/freebsd_index.html">5. FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../openbsd/openbsd_index.html">6. OpenBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netbsd/netbsd_index.html">7. NetBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dragonflybsd/dragonflybsd_index.html">8. DragonFlyBSD</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BSDForen.de</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="howto_index.html"><span class="section-number">1. </span>Howto</a> &raquo;</li>
        
      <li><span class="section-number">1.49. </span>Festplattenverschlüsselung mit NetBSD</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/howto/festplattenverschluesselung_mit_netbsd.txt.rst.txt" rel="nofollow"> Quelltext anzeigen</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="festplattenverschlusselung-mit-netbsd">
<h1><span class="section-number">1.49. </span>Festplattenverschlüsselung mit NetBSD<a class="headerlink" href="#festplattenverschlusselung-mit-netbsd" title="Link zu dieser Überschrift">¶</a></h1>
<div class="sidebar">
<p class="sidebar-title">Info</p>
<img alt="../_images/logo-netbsd.png" src="../_images/logo-netbsd.png" />
</div>
<div class="section" id="uber">
<h2><span class="section-number">1.49.1. </span>Über<a class="headerlink" href="#uber" title="Link zu dieser Überschrift">¶</a></h2>
<p>NetBSD ist ein vielseitiges Betriebssystem. Es ist in weiten Teilen
hervorragend dokumentiert, nur der Teil zur Festplattenverschlüsselung
reduziert sich leider auf das aller Wesentlichste. Für Leute, die nicht
so viel Erfahrung mit NetBSD haben, aber ihr System physikalisch
absichern wollen gestaltet sich diese Aufgabe ohne genau Anleitung meist
sehr schwierig, oft zu schwierig. Dem will ich mit diesem Artikel
Abhilfe schaffen.</p>
<p>Dieser Artikel basiert auf einem Englischen HowTo von Johnny C. Lam
(siehe Weblinks). Der Festplattenverschlüsselungsteil ist fast fertig.
Wer will kann ihn Testen, verbessern und erweitern</p>
</div>
<div class="section" id="der-weg">
<h2><span class="section-number">1.49.2. </span>Der Weg<a class="headerlink" href="#der-weg" title="Link zu dieser Überschrift">¶</a></h2>
<div class="section" id="anforderungen">
<h3><span class="section-number">1.49.2.1. </span>Anforderungen<a class="headerlink" href="#anforderungen" title="Link zu dieser Überschrift">¶</a></h3>
<ul class="simple">
<li><p>Ein NetBSD Installationsmedium (CD, Diskette, …)</p></li>
<li><p>USB-Stick, auf dem der Schlüssel gespeichert wird - kann praktisch
beliebiger Größe sein</p></li>
<li><p>Selbstverständlich brauchen wir auch ein System, auf welches NetBSD
installiert werden. Es gibt dabei kaum ein System, das nicht in Frage
kommt. Man sollte allerdings aufpassen, dass sich das System auch
wirklich für verschlüsselte Partitionen eignet und nicht so schon zu
langsam ist</p></li>
</ul>
</div>
<div class="section" id="backup">
<h3><span class="section-number">1.49.2.2. </span>Backup<a class="headerlink" href="#backup" title="Link zu dieser Überschrift">¶</a></h3>
<p>Wie vor jeder Installation, sollte man darauf achten, dass es ein Backup
aller wichtigen Daten existiert. Man sollte dieses Backup
selbstverständlich nicht auf dem dem System haben, auf dem die
Installation stattfinden soll.</p>
</div>
<div class="section" id="netbsd-installieren">
<h3><span class="section-number">1.49.2.3. </span>NetBSD installieren<a class="headerlink" href="#netbsd-installieren" title="Link zu dieser Überschrift">¶</a></h3>
<p>Es ist von Vorteil, aber nicht zwingend notwendig, mit der Installation
vertraut zu sein. Die Installation verläuft mit ein paar Ausnahmen, wie
immer.</p>
<div class="section" id="der-unveranderte-teil">
<h4><span class="section-number">1.49.2.3.1. </span>Der unveränderte Teil<a class="headerlink" href="#der-unveranderte-teil" title="Link zu dieser Überschrift">¶</a></h4>
<p>NetBSD wird, wie gewohnt gebootet und fragt zuerst nach der gewünschten
Sprache und dem Keyboardlayout. Da NetBSD installiert werden soll, wird
nächsten Menü den entsprechende Punkt ausgewählt. Der Installer macht
nochmals darauf aufmerksam, dass wir NetBSD installieren und unbedingt
ein Backup gemacht werden sollte. Im nächsten Schritt wird nach der
Festplatte gefragt auf welche NetBSD installiert werden soll. Nach der
Auswahl schlägt der Installer einige Möglichkeiten der Installation vor.
Für NetBSD-Neulinge empfiehlt sich hier die komplette Installation. Alle
Anderen sollten selbst wissen, welchen Punkt sie wählen.</p>
</div>
<div class="section" id="was-beachtet-werden-muss">
<h4><span class="section-number">1.49.2.3.2. </span>Was beachtet werden muss<a class="headerlink" href="#was-beachtet-werden-muss" title="Link zu dieser Überschrift">¶</a></h4>
<p>Der nächste Schritt betrifft die Partitionierung, diese soll verändert
werden. Drei Partitionen werden angelegt.</p>
<ul class="simple">
<li><p>Root (/) (unverschlüsselt!): diese sollte mindestens 256MB haben,
aber muss nicht größer sein. Auf sie wird NetBSD installiert.</p></li>
<li><p>Swap (verschlüsselt): Wie gewohnt. Als Faustregel für die Größe gilt
2*RAM</p></li>
<li><p>Crypt (/crypt) (verschlüsselt): Hier landen alle Daten, die
verschlüsselt werden sollen/können. Diese Partition sollte den
restlichen verfügbaren Platz bekommen. Dazu wird einfach ein „+“
statt der Menge in Megabyte verwendet.</p></li>
</ul>
<p>Nachdem man die Größen gewählt und akzeptiert hat wird nach den Optionen
für die erstellen Partitionen gewählt. Die Einzige Partition, die eine
Anpassung benötigt ist /crypt. Dazu wählen wir sie aus und ändern den
Dateisystemtyp auf ccd, welcher unter „andere Dateisystemtypen“ zu
finden ist.</p>
</div>
<div class="section" id="installation-fertig-stellen">
<h4><span class="section-number">1.49.2.3.3. </span>Installation fertig stellen<a class="headerlink" href="#installation-fertig-stellen" title="Link zu dieser Überschrift">¶</a></h4>
<p>Der Rest der Installation verläuft wie gewohnt.</p>
</div>
<div class="section" id="neustart-in-den-single-user-mode">
<h4><span class="section-number">1.49.2.3.4. </span>Neustart in den Single User Mode<a class="headerlink" href="#neustart-in-den-single-user-mode" title="Link zu dieser Überschrift">¶</a></h4>
<p>Nach der Installation erfolgt der Neustart des Sytems. Da die
Partitionen sind allerdings noch nicht verschlüsselt. Um das zu tun
wählt man im Bootloader den Single User Mode aus. Dort wird die
Standardshell verwendet, also einfach Eingabe drücken. &lt;note tip&gt;Das
Standard Keyboard Layout ist englisch. Um es auf deutsch zu stellen
nutzt man <strong>wsconsctl -k -w encoding=de</strong>&lt;/note&gt; Im Single User Mode
mountet man die Root-Partition mit einem</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># mount -uw /</span>
</pre></div>
</div>
<p>Da das in das Basissystem aus Sicherheitsgründen read-only gemountet
werden soll müssen einige Mountpoints erstellt werden.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># mkdir /emul /crypt /usr/pkg</span>
</pre></div>
</div>
<p>Wie erwähnt soll das System read-only sein. Das führt mit der
Standard-rc zu ein paar Problemen. Deshalb muss /etc/rc leicht
abgeändert werden. Dazu wird einfach die Zeile <strong>[ „$rc_hooked“ = „YES“
] || . /etc/rc.hook</strong> hinzugefügt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">rc</span><span class="o">.</span><span class="n">subr</span>
<span class="o">.</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">rc</span><span class="o">.</span><span class="n">conf</span>
<span class="p">[</span> <span class="s2">&quot;$rc_hooked&quot;</span> <span class="o">=</span> <span class="s2">&quot;YES&quot;</span> <span class="p">]</span> <span class="o">||</span> <span class="o">.</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">rc</span><span class="o">.</span><span class="n">hook</span>
<span class="n">_rc_conf_loaded</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
<p>Damit der USB-Stick mit dem Schlüssel gefunden wird, wird außerdem ein
<strong>usbkeydev=sd0</strong> in /etc/rc.conf benötigt.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add local overrides below</span>
<span class="c1">#</span>
<span class="n">usbkeydev</span><span class="o">=</span><span class="n">sd0</span>
</pre></div>
</div>
<p>Als nächstes wird der USB-Stick mit dem Key bestückt. Dazu muss der (mit
FAT formatierter) Stick zuerst gemountet werden:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># mount -t msdos /dev/sd0e /mnt</span>
</pre></div>
</div>
<p>Nun kann verschlüsselt werden (&lt;crypt&gt; ist durch die /crypt-Partition zu
ersetzen) :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># cgdconfig -g -V disklabel -k storedkey -k pkcs5_pbkdf2/sha1 -o /mnt/key aes-cbc 256</span>
<span class="c1"># cgdconfig -V re-enter cgd0 /dev/&lt;crypt&gt; /mnt/key</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/&lt;</span><span class="n">crypt</span><span class="o">&gt;</span><span class="s1">&#39;s passphrase: **********</span>
<span class="n">re</span><span class="o">-</span><span class="n">enter</span> <span class="n">device</span><span class="s1">&#39;s passphrase: **********</span>
</pre></div>
</div>
<p><strong>cgd0</strong> ist die verschlüsselte Partition. Sie kann wie jede Andere
verwendet werden. Zuerst wird sie formatiert und mit allem, was
verschlüsselt werden darf/soll bestückt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># newfs /dev/cgd0a</span>
<span class="c1"># mount -t ffs /dev/cgd0a /crypt</span>
<span class="c1"># cd / &amp;&amp; pax -rwpe etc root tmp var /crypt</span>
</pre></div>
</div>
<p>Um auch die verschlüsselten Daten zu verwenden muss /etc/fstab angepasst
werden:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">root</span> <span class="o">/</span> <span class="n">ffs</span> <span class="n">ro</span> <span class="mi">1</span> <span class="mi">1</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">swap</span> <span class="n">none</span> <span class="n">swap</span> <span class="n">sw</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">crypt</span> <span class="o">/</span><span class="n">local</span> <span class="n">ffs</span> <span class="n">rw</span><span class="p">,</span><span class="n">noatime</span><span class="p">,</span><span class="n">nodevmtime</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="o">/</span><span class="n">crypt</span><span class="o">/</span><span class="n">etc</span> <span class="o">/</span><span class="n">etc</span> <span class="n">null</span> <span class="n">rw</span><span class="p">,</span><span class="n">hidden</span>
<span class="o">/</span><span class="n">crypt</span><span class="o">/</span><span class="n">tmp</span> <span class="o">/</span><span class="n">tmp</span> <span class="n">null</span> <span class="n">rw</span><span class="p">,</span><span class="n">hidden</span>
<span class="o">/</span><span class="n">crypt</span><span class="o">/</span><span class="n">var</span> <span class="o">/</span><span class="n">var</span> <span class="n">null</span> <span class="n">rw</span><span class="p">,</span><span class="n">hidden</span>
<span class="o">/</span><span class="n">crypt</span><span class="o">/</span><span class="n">root</span> <span class="o">/</span><span class="n">root</span> <span class="n">null</span> <span class="n">rw</span><span class="p">,</span><span class="n">hidden</span>
<span class="n">kernfs</span> <span class="o">/</span><span class="n">kern</span> <span class="n">kernfs</span> <span class="n">rw</span>
<span class="n">procfs</span> <span class="o">/</span><span class="n">proc</span> <span class="n">procfs</span> <span class="n">rw</span><span class="p">,</span><span class="n">noauto</span>
</pre></div>
</div>
<p>Da all diese Partitionen möglichst früh gemountet werden sollen muss
<strong>/crypt/etc/rc.conf</strong> angepasst werden.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rc_hooked</span><span class="o">=</span><span class="n">YES</span>
<span class="n">critical_filesystems_local</span><span class="o">=</span><span class="s2">&quot;/crypt /etc /tmp /var&quot;</span>
<span class="n">securelevel</span><span class="o">=</span><span class="mi">2</span>
</pre></div>
</div>
<p>Jetzt muss nur noch das <strong>/etc/rc.hook</strong> script mit folgendem Inhalt
platziert werden:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Copyright (c) 2007 Johnny C. Lam.  All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
# 3. The name of the author may not be used to endorse or promote
#    products derived from this software without specific prior written
#    permission.
#
# THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS&#39;&#39; AND ANY EXPRESS
# OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
# WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
# ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY
# DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
# GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
# INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
# NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
# SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#

#############################################################################
#
# usbkeydev disk device that stores the cgd(4) params file; if unset,
#       in /etc/rc.conf, then it&#39;s assumed the params file lives
#       in /etc/cgd.
#
# hostname  if usbkeydev is defined, then $hostname is the name of
#       the params file on $usbkeydev if it is set.
#
: ${usbkeydev=}
#
#############################################################################

#
# num2alpha n
#   Prints the (n-1)th letter of the alphabet to standard output.
#
num2alpha()
{
    local _n
    _n=$1; shift
    set -- a b c d e f g h i j k l m n o p q r s t u v w x y z
    shift $_n
    echo $1
}

#
# find_free_disk dev var [...]
#   Look for free disk devices named by $1 and set them as values
#   for the named variables.
#
#   Returns 0 if all named variables were set, and nonzero otherwise.
#
#   For example, the following will set vndlocal and vndswap to the
#   first free vnd devices on the system:
#
#       find_free_disk vnd vndlocal vndswap
#
find_free_disk()
{
    local _arg _d _dev _devices _devstatus _k _rawpart _value _var
    _dev=&quot;$1&quot;; shift    # Remaining args are variables to set.

    _rawpart=`sysctl -n kern.rawpartition`
    _rawpart=`num2alpha $_rawpart`

    # Set _dev1, _dev2, etc. variables to &quot;free&quot; or &quot;used&quot; based on
    # whether the device is already named in &quot;sysctl -n hw.disknames&quot;.
    #
    _devices=
    _k=0
    while [ 1 = 1 ]; do
        [ -b /dev/${_dev}${_k}${_rawpart} ] || break
        _devices=&quot;$_devices ${_dev}${_k}&quot;
        _k=$((_k + 1))
    done
    [ $_k != 0 ] || return 1

    for _d in $_devices; do
        _var=_${_d}
        eval $_var=free
    done
    for _d in `sysctl -n hw.disknames`; do
        case $_d in
        ${_dev}[0-9]*)
            _var=_${_d}
            eval $_var=used
            ;;
        esac
    done

    # Set named variables to first free devices.
    for _d in $_devices; do
        _var=_${_d}
        eval _devstatus=\$${_var}
        if [ &quot;$_devstatus&quot; = &quot;used&quot; ]; then
            unset $_var
            continue
        fi
        for _arg in &quot;$@&quot;; do
            eval _value=\$${_arg}
            if [ -z &quot;$_value&quot; ]; then
                eval ${_arg}=${_d}
                break
            fi
        done
        unset $_var
    done

    for _arg in &quot;$@&quot;; do
        eval _value=\$${_arg}
        [ -n &quot;$_value&quot; ] || return 1
    done
    return 0
}

#
# mount_usbkey dev mountpoint
#   Mounts the USB key specified in $1 at the mount point specified
#   in $2.
#
#   If the device is specified as a path of the form &quot;/dev/*&quot;, then
#   it is used as the MSDOS partition to mount.  Otherwise, the
#   device is taken to be a simple device name, e.g. &quot;sd0&quot;, and the
#   disklabel of the device is searched for the first MSDOS partition
#   to mount.
#
#   Returns 0 on a successful mount, and nonzero otherwise.
#
#   For example, the following will mount the first MSDOS partition
#   on sd0 onto /mnt:
#
#       mount_usbkey sd0 /mnt
#
mount_usbkey()
{
    local _dev _mntpt
    _dev=$1; _mntpt=$2

    case &quot;$_dev&quot; in
    /dev/*)
        mount -r -t msdos $_dev $_mntpt || return 1
        ;;
    *)
        # Mount the first MSDOS partition found on $_dev.
        _dev=${_dev##*/}
        disklabel $_dev 2&gt;/dev/null |
        while read _line; do
            case &quot;$_line&quot; in
            [a-z]:*MSDOS*)
                _dev=/dev/${_dev}${_line%%:*}
                mount -r -t msdos $_dev $_mntpt || return 1
            esac
        done
        case $? in
        0)  ;;
        *)  return $? ;;
        esac
        ;;
    esac
    return 0
}

#
# crypto_swap cgd swapdev
#   Creates the cgd(4) device named in $1 in the partition named in
#   $2 and rewrites the disklabel on the device so that the whole
#   device is a swap partition.
#
#   If the device is specified as a path of the form &quot;/dev/*&quot;, then
#   it is used as the swap partition to configure.  Otherwise, the
#   device is taken to be a simple device name, e.g. &quot;wd0&quot;, and the
#   disklabel of the device is searched for the first swap partition
#   to configure.
#
#   Returns 0 if the encrypted swap partition was successfully
#   set up, and nonzero otherwise.
#
#   For example, the following configures cgd1 onto the first swap
#   partition on wd0:
#
#       crypto_swap cgd1 wd0
#
crypto_swap()
{
    local _cgd _dev _rawpart
    _cgd=$1; _dev=$2

    case &quot;$_dev&quot; in
    /dev/*)
        cgdconfig -s $_cgd $_dev aes-cbc &lt; /dev/urandom || return 1
        ;;
    *)
        # Configure the first swap partition found on $_dev.
        _dev=${_dev##*/}
        disklabel $_dev 2&gt;/dev/null |
        while read _line; do
            case &quot;$_line&quot; in
            [a-z]:*swap*)
                _dev=/dev/${_dev}${_line%%:*}
                cgdconfig -s $_cgd $_dev aes-cbc 256 &lt; /dev/urandom || return 1
            esac
        done
        case $? in
        0)  ;;
        *)  return $? ;;
        esac
        ;;
    esac

    _rawpart=`sysctl -n kern.rawpartition`
    _rawpart=`num2alpha $_rawpart`

    # Rewrite the disklabel on the newly-configured cgd(4) device
    # so that the whole disk is used for swap.
    #
    disklabel $_cgd 2&gt;/dev/null |
    while read _line; do
        case &quot;$_line&quot; in
        ${_rawpart}:*)
            _bline=&quot; b:${_line#${_rawpart}:}&quot;
            _bline=&quot;${_bline%%unused*}  swap${_bline##*unused}&quot;
            echo &quot;$_bline&quot;
            echo &quot;$_line&quot;
            ;;
        [a-z]:*) ;;
        *)  echo &quot;$_line&quot; ;;
        esac
    done | disklabel -R -r $_cgd /dev/stdin 2&gt;/dev/null

    case $? in
    0)  ;;
    *)  cgdconfig -u $_cgd
        return 2
        ;;
    esac

    return 0
}

#
# crypto_partition cgd dev [usbkeydev [paramsfile]]
#   Creates the cgd(4) device named in $1 in the partition named in
#   $2.  If the $3 argument is specified, then it is the partition
#   from which the cgd(4) params file should be loaded.  If the $4
#   argument is specified, then it is the name of the cgd(4) params
#   file to use.
#
#   The cgd(4) params file is searched in the following order:
#
#       /mnt/$paramsfile    (if paramsfile is specified)
#       /mnt/cgd/$paramsfile    (if paramsfile is specified)
#       /mnt/$dev       e.g., /mnt/wd0e
#       /mnt/cgd/$dev       e.g., /mnt/cgd/wd0e
#       /etc/cgd/$dev       e.g., /etc/cgd/wd0e
#
#   Returns 0 if the encrypted partition was successfully
#   configured, and nonzero otherwise.
#
#   For example, the following configures cgd0 on the first &quot;ccd&quot;
#   partition on wd0, and uses the params file named &quot;/myhostname&quot;
#   or &quot;/cgd/myhostname&quot; from sd0:
#
#       crypto_partition cgd0 wd0 sd0 myhostname
#
crypto_partition()
{
    local _cgd _cgdparams _dev _keydev _paramsfile
    _cgd=$1; _dev=$2; _keydev=$3; _paramsfile=$4

    # Mount the sd(4) device on the USB key drive onto /mnt to locate
    # the cgd(4) params file.
    #
    if [ -n &quot;$_keydev&quot; ]; then
        mount_usbkey $_keydev /mnt || return 1
    fi

    # Look for the cgd(4) params file.
    _paramlist=&quot;/mnt/${_dev##*/} /mnt/cgd/${_dev##*/} /etc/cgd/${_dev##*/}&quot;
    if [ -n &quot;$_paramsfile&quot; ]; then
        _paramlist=&quot;/mnt/$_paramsfile /mnt/cgd/$_paramsfile $_paramlist&quot;
    fi
    for _file in $_paramlist; do
        if [ -f &quot;$_file&quot; ]; then
            _cgdparams=&quot;$_file&quot;
            break
        fi
    done

    case &quot;$_dev&quot; in
    /dev/*)
        if ! cgdconfig $_cgd $_dev $_cgdparams; then
            [ -z &quot;$_keydev&quot; ] || umount /mnt
            return 2
        fi
        ;;
    *)
        # Configure the first ccd partition found on $_dev.
        _dev=${_dev##*/}
        disklabel $_dev 2&gt;/dev/null |
        while read _line; do
            case &quot;$_line&quot; in
            [a-z]:*ccd*)
                _dev=/dev/${_dev}${_line%%:*}
                if ! cgdconfig $_cgd $_dev $_cgdparams; then
                    [ -z &quot;$_keydev&quot; ] || umount /mnt
                    return 2
                fi
            esac
        done
        case $? in
        0)  ;;
        *)  return $? ;;
        esac
        ;;
    esac
    [ -z &quot;$_keydev&quot; ] || umount /mnt
    return 0
}

_rootdev=`sysctl -n kern.root_device`
_rootpart=`sysctl -n kern.root_partition`
_rootpart=`num2alpha $_rootpart`

# Find 2 free cgd(4) devices and set them as values for _cgdlocal and
# _cgdswap.
#
if ! find_free_disk cgd _cgdlocal _cgdswap; then
    echo &quot;Not enough free cgd(4) devices found.  Multiuser boot aborted.&quot;
    exit 1
fi

echo &quot;Configuring encrypted swap partition&quot;
if ! crypto_swap $_cgdswap $_rootdev; then
    echo &quot;Unable to configure encrypted swap partition. &quot; \
         &quot;Multiuser boot aborted.&quot;
    exit 1
fi

echo &quot;Configuring encrypted local device&quot;
if ! crypto_partition $_cgdlocal $_rootdev $usbkeydev $hostname; then
    echo &quot;Unable to configure encrypted local device. &quot; \
         &quot;Multiuser boot aborted.&quot;
    exit 1
fi

# Mount /local to get the local configuration data.  We must fsck(8) the
# partition beforehand to ensure that it&#39;s clean because we won&#39;t be able
# to fix any problems later on after other filesystems are mounted.
#
echo &quot;Starting bootstrap file system check:&quot;
fsck -p /dev/r${_rootdev}${_rootpart} /dev/r${_cgdlocal}a
case $? in
0)  ;;
*)  echo &quot;Automatic bootstrap file system check failed; help!&quot;
    exit 1
    ;;
esac

echo &quot;Mounting /local for read-write local data&quot;
if ! mount -t ffs -o noatime,nodevmtime /dev/${_cgdlocal}a /local; then
    echo &quot;Unable to mount /local.  Multiuser boot aborted.&quot;
    exit 1
fi

echo &quot;Mounting /etc for local configuration&quot;
if ! mount -t null -o hidden /local/etc /etc; then
    echo &quot;Unable to mount /etc.  Multiuser boot aborted.&quot;
    exit 1
fi

echo &quot;Fixing /etc/fstab&quot;
if [ ! -f /etc/fstab ]; then
    echo &quot;Could not find /etc/fstab.  Multiuser boot aborted.&quot;
    exit 1
fi
while read _device _mntpt _fstype _rest; do
    case &quot;$_device&quot; in
    &quot;#&quot;*)   ;;
    *)  case &quot;$_mntpt&quot; in
        /)  _device=&quot;/dev/${_rootdev}${_rootpart}&quot; ;;
        /local) _device=&quot;/dev/${_cgdlocal}a&quot; ;;
        *)  [ &quot;$_fstype&quot; != &quot;swap&quot; ] || _device=&quot;/dev/${_cgdswap}b&quot; ;;
        esac
        ;;
    esac
    if [ -z &quot;$_rest&quot; ]; then
        echo &quot;$_device $_mntpt $_fstype&quot;
    else
        echo &quot;$_device $_mntpt $_fstype $_rest&quot;
    fi
done &lt; /etc/fstab &gt; /etc/fstab.hooked
mv -f /etc/fstab.hooked /etc/fstab

# Re-exec /etc/rc so that we use the correct configuration information,
# e.g., /etc/rc.conf settings, etc.
#
echo &quot;Re-executing boot process with local configuration&quot;
exec /bin/sh $0
</pre></div>
</div>
<p>Fertig! Finger kreuzen und neu starten:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># umount /local /mnt</span>
<span class="c1"># cgdconfig -u cgd0</span>
<span class="c1"># reboot</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="weblinks">
<h2><span class="section-number">1.49.3. </span>Weblinks<a class="headerlink" href="#weblinks" title="Link zu dieser Überschrift">¶</a></h2>
<p><a class="reference external" href="http://www.netbsd.org/~jlam/cgd_laptop.html">Guide, auf dem dieser Artikel basiert (leicht
veraltet)</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TODO</span><span class="p">:</span>
<span class="n">Probelesen</span>
<span class="n">Fertig</span> <span class="n">machen</span> <span class="p">(</span><span class="n">swap</span><span class="p">)</span>
<span class="n">Genauer</span> <span class="n">erklären</span><span class="p">,</span> <span class="n">warum</span> <span class="n">was</span> <span class="n">getan</span> <span class="n">wird</span>
<span class="n">Wiki</span><span class="o">-</span><span class="n">Syntax</span> <span class="n">Überarbeitung</span>
<span class="n">Sprachliche</span> <span class="n">Überarbeitung</span>
<span class="n">nochmal</span> <span class="n">Probelesen</span>
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference internal" href="../genindex.html"><span class="std std-ref">Stichwortverzeichnis</span></a></p></li>
</ul>
<p>Zuletzt geändert: 2021-05-29</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="festplattenverschluesselung_mit_pefs.txt.html" class="btn btn-neutral float-right" title="1.50. Festplattenverschlüsselung mit pefs" accesskey="n" rel="next">Weiter <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="festplattenverschluesselung_mit_geli_und_usb_boot.txt.html" class="btn btn-neutral float-left" title="1.48. Festplattenverschlüsselung mit Geli und USB Boot" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Zurück</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, BSDForen.de.

    </p>
  </div>
    
    
    
    Erstellt mit <a href="https://www.sphinx-doc.org/">Sphinx</a> mit einem
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    bereitgestellt von <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>