

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="de" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="de" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1.65. IPSEC-VPN &mdash; BSDForen.de 1.0 Dokumentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Stichwortverzeichnis" href="../genindex.html" />
    <link rel="search" title="Suche" href="../search.html" />
    <link rel="next" title="1.66. IPv6-Netzwerke mit FreeBSD als Router" href="ipv6_netzwerke.txt.html" />
    <link rel="prev" title="1.64. Intel 2200BG" href="intel2200bg.txt.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> BSDForen.de
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="howto_index.html">1. Howto</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="3d-grafik-beschleunigung.txt.html">1.1. 3D-Grafik-Beschleunigung</a></li>
<li class="toctree-l2"><a class="reference internal" href="anschluss_an_das_internet_mit_pppoe_mpd_und_firewall_pf.txt.html">1.2. Anschluss an das Internet mit PPPoe (mpd) und Firewall (pf)</a></li>
<li class="toctree-l2"><a class="reference internal" href="apache_mit_php5_installieren.txt.html">1.3. Apache mit php5 installieren</a></li>
<li class="toctree-l2"><a class="reference internal" href="asterisk_voip_telefonanalge.txt.html">1.4. Asterisk</a></li>
<li class="toctree-l2"><a class="reference internal" href="audio-cd_rippen.txt.html">1.5. Audio-CD rippen</a></li>
<li class="toctree-l2"><a class="reference internal" href="aufloesung_der_konsole_aendern.txt.html">1.6. Auflösung der Konsole ändern</a></li>
<li class="toctree-l2"><a class="reference internal" href="authpf.txt.html">1.7. authpf</a></li>
<li class="toctree-l2"><a class="reference internal" href="autologin_auf_der_konsole.txt.html">1.8. Autologin auf der Konsole</a></li>
<li class="toctree-l2"><a class="reference internal" href="automatische_proxy-konfiguration.txt.html">1.9. Automatische Proxy-Konfiguration</a></li>
<li class="toctree-l2"><a class="reference internal" href="automatisches_beenden_von_diensten.txt.html">1.10. Automatisches Beenden von Diensten</a></li>
<li class="toctree-l2"><a class="reference internal" href="automount.txt.html">1.11. Automount</a></li>
<li class="toctree-l2"><a class="reference internal" href="awk.txt.html">1.12. AWK</a></li>
<li class="toctree-l2"><a class="reference internal" href="backup_auf_cd-r.txt.html">1.13. Backup auf CD-R</a></li>
<li class="toctree-l2"><a class="reference internal" href="backup_mit_hammer.txt.html">1.14. Backup mit HAMMER</a></li>
<li class="toctree-l2"><a class="reference internal" href="backup_ueber_das_netzwerk.txt.html">1.15. Backup über das Netzwerk</a></li>
<li class="toctree-l2"><a class="reference internal" href="batterieueberwachung.txt.html">1.16. Batterieüberwachung</a></li>
<li class="toctree-l2"><a class="reference internal" href="beseitigen_von_problemen_und_fehlern.txt.html">1.17. Beseitigen von Problemen und Fehlern</a></li>
<li class="toctree-l2"><a class="reference internal" href="bluetooth.txt.html">1.18. Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="bootvorgang_verschoenern.txt.html">1.19. Bootvorgang verschönern/verkürzen</a></li>
<li class="toctree-l2"><a class="reference internal" href="canon_eos_1100d_mit_gphoto_und_gimp_betreiben.txt.html">1.20. Verwendung einer Canon EOS 1100D mit Gimp im Tethering Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="cd_iso_to_usb.txt.html">1.21. FreeBSD CD-ISO in USB Stick Image umwandeln</a></li>
<li class="toctree-l2"><a class="reference internal" href="chinesisch_schreiben.txt.html">1.22. Chinesisch schreiben</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpu_stepping.txt.html">1.23. CPU Stepping (cpufreq, powerd)</a></li>
<li class="toctree-l2"><a class="reference internal" href="crossbuilding_freebsd.txt.html">1.24. Crossbuilding FreeBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="crunchbsd.txt.html">1.25. CrunchBang Desktop</a></li>
<li class="toctree-l2"><a class="reference internal" href="cups_-_drucken_in_heterogener_umgebung.txt.html">1.26. CUPS - Drucken in heterogener Umgebung</a></li>
<li class="toctree-l2"><a class="reference internal" href="cups_-_installation_und_konfiguration.txt.html">1.27. CUPS - Installation und Konfiguration</a></li>
<li class="toctree-l2"><a class="reference internal" href="cups_-_installation_und_konfiguration.txt.html#drucker-einrichten-unter-cups">1.28. Drucker einrichten unter CUPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="datenrettung.txt.html">1.29. Datenrettung</a></li>
<li class="toctree-l2"><a class="reference internal" href="deutsche_sprachausgabe_mit_festival.txt.html">1.30. Deutsche Sprachausgabe mit Festival</a></li>
<li class="toctree-l2"><a class="reference internal" href="deutsche_sprachausgabe_mit_festival.txt.html#kmouth-mit-festival">1.31. KMouth mit Festival</a></li>
<li class="toctree-l2"><a class="reference internal" href="devfs.txt.html">1.32. devfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="dhcp-server_einrichten.txt.html">1.33. DHCP-Server einrichten</a></li>
<li class="toctree-l2"><a class="reference internal" href="dns-cache.txt.html">1.34. DNS-Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="drucken_mit_apsfilter.txt.html">1.35. Drucken mit Apsfilter</a></li>
<li class="toctree-l2"><a class="reference internal" href="drucken_mit_windows.txt.html">1.36. Drucken mit Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="dsl-router.txt.html">1.37. DSL-Router</a></li>
<li class="toctree-l2"><a class="reference internal" href="dsl_konfigurieren_netbsd.txt.html">1.38. DSL konfigurieren (NetBSD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="dvb-t_karte_hauppauge_wintv-hvr_1300.txt.html">1.39. DVB-T Karte Hauppauge WinTV-HVR 1300</a></li>
<li class="toctree-l2"><a class="reference internal" href="dvb_unter_freebsd.txt.html">1.40. DVB unter FreeBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="dvd-rip_mit_mencoder.txt.html">1.41. DVD-Rip mit mencoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="dvds_brennen.txt.html">1.42. DVDs brennen</a></li>
<li class="toctree-l2"><a class="reference internal" href="ed2k-protokoll.txt.html">1.43. ed2k-Protokoll beim Mozilla, Seamonkey und Firefox</a></li>
<li class="toctree-l2"><a class="reference internal" href="eigenes_live-system_auf_usb-stick_installieren.txt.html">1.44. Eigenes Live-System auf USB-Stick installieren</a></li>
<li class="toctree-l2"><a class="reference internal" href="externe_projekte.txt.html">1.45. Mail</a></li>
<li class="toctree-l2"><a class="reference internal" href="ezjail.txt.html">1.46. Ezjail</a></li>
<li class="toctree-l2"><a class="reference internal" href="festplatte_einrichten.txt.html">1.47. Festplatte einrichten</a></li>
<li class="toctree-l2"><a class="reference internal" href="festplatte_einrichten_gpt.txt.html">1.48. Manuelle Verwaltung von Festplatten nach neuem GUID Partition Table (GPT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="festplattenverschluesselung_mit_geli_und_usb_boot.txt.html">1.49. Festplattenverschlüsselung mit Geli und USB Boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="festplattenverschluesselung_mit_netbsd.txt.html">1.50. Festplattenverschlüsselung mit NetBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="festplattenverschluesselung_mit_pefs.txt.html">1.51. Festplattenverschlüsselung mit pefs</a></li>
<li class="toctree-l2"><a class="reference internal" href="film-dvd_erstellen.txt.html">1.52. Film-DVD erstellen</a></li>
<li class="toctree-l2"><a class="reference internal" href="firewall-regeln.txt.html">1.53. Firewall-Regeln</a></li>
<li class="toctree-l2"><a class="reference internal" href="floppy.txt.html">1.54. Floppy</a></li>
<li class="toctree-l2"><a class="reference internal" href="fluxbox_mit_gdm.txt.html">1.55. Fluxbox mit gdm</a></li>
<li class="toctree-l2"><a class="reference internal" href="freebsd_als_gast_unter_vmware.txt.html">1.56. FreeBSD als Gast unter VMware</a></li>
<li class="toctree-l2"><a class="reference internal" href="freebsd_boot_manager_und_vista.txt.html">1.57. FreeBSD Boot Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="ftp-server_mit_pureftpd.txt.html">1.58. FTP-Server mit PureFTPd</a></li>
<li class="toctree-l2"><a class="reference internal" href="gnupg.txt.html">1.59. GnuPG</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpsdrive.txt.html">1.60. GPSDrive</a></li>
<li class="toctree-l2"><a class="reference internal" href="grafikausgabe_im_netzwerk.txt.html">1.61. Grafikausgabe im Netzwerk: X11, XDM und XDMCP</a></li>
<li class="toctree-l2"><a class="reference internal" href="grub2-anleitung.txt.html">1.62. GRUB2-Anleitung</a></li>
<li class="toctree-l2"><a class="reference internal" href="ibm_thinkpad_bios-update.txt.html">1.63. IBM Thinkpad BIOS-Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="intel2200bg.txt.html">1.64. Intel 2200BG</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">1.65. IPSEC-VPN</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#versuchsaufbau">1.65.1. Versuchsaufbau</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ipsec-einrichtung">1.65.2. IPSEC-Einrichtung</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#aktivieren-von-ipsec-im-kernel">1.65.2.1. Aktivieren von IPSec im Kernel</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#einstellungen-im-basissytem">1.65.3. Einstellungen im Basissytem</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#etc-rc-conf">1.65.3.1. /etc/rc.conf</a></li>
<li class="toctree-l4"><a class="reference internal" href="#etc-ipsec-conf">1.65.3.2. /etc/ipsec.conf</a></li>
<li class="toctree-l4"><a class="reference internal" href="#racoon">1.65.3.3. Racoon</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usr-local-etc-racoon-racoon-conf">1.65.3.4. /usr/local/etc/racoon/racoon.conf</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usr-local-etc-racoon-psk-txt">1.65.3.5. /usr/local/etc/racoon/psk.txt</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#paketfilter-konfiguration">1.65.4. Paketfilter-Konfiguration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#einstellungen-im-basissystem">1.65.4.1. Einstellungen im Basissystem</a></li>
<li class="toctree-l4"><a class="reference internal" href="#etcrc-conf-1">1.65.4.2. /etc/rc.conf</a></li>
<li class="toctree-l4"><a class="reference internal" href="#etc-natd-conf">1.65.4.3. /etc/natd.conf</a></li>
<li class="toctree-l4"><a class="reference internal" href="#etc-ipfw-conf">1.65.4.4. /etc/ipfw.conf</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ipv6_netzwerke.txt.html">1.66. IPv6-Netzwerke mit FreeBSD als Router</a></li>
<li class="toctree-l2"><a class="reference internal" href="irc-protokoll.txt.html">1.67. irc-Protokoll im Mozilla, Seamonkey und Firefox</a></li>
<li class="toctree-l2"><a class="reference internal" href="iso-erstellung_openbsd.txt.html">1.68. ISO-Erstellung (OpenBSD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="iso-images_mounten.txt.html">1.69. ISO-Images mounten</a></li>
<li class="toctree-l2"><a class="reference internal" href="iso-images_von_optischen_medien_erzeugen.txt.html">1.70. ISO-Images von optischen Medien erzeugen</a></li>
<li class="toctree-l2"><a class="reference internal" href="jails.txt.html">1.71. Jails</a></li>
<li class="toctree-l2"><a class="reference internal" href="java_installation.txt.html">1.72. Java Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="k3b_einrichten.txt.html">1.73. K3B einrichten</a></li>
<li class="toctree-l2"><a class="reference internal" href="kde4-tipps.txt.html">1.74. KDE4 Tipps</a></li>
<li class="toctree-l2"><a class="reference internal" href="kdm.txt.html">1.75. KDM</a></li>
<li class="toctree-l2"><a class="reference internal" href="kerio_mailserver.txt.html">1.76. Kerio Mailserver</a></li>
<li class="toctree-l2"><a class="reference internal" href="konsole_nach_systemstart_und_logout_loeschen.txt.html">1.77. Konsole nach Systemstart und Logout löschen</a></li>
<li class="toctree-l2"><a class="reference internal" href="kopplung_zweier_stationen_mittels_rfc3378_via_wlan_freebsd.txt.html">1.78. Kopplung zweier Stationen mittels RFC3378 via WLAN (FreeBSD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="m0n0wall_sip.txt.html">1.79. M0n0wall &amp; SIP</a></li>
<li class="toctree-l2"><a class="reference internal" href="mailhamster.txt.html">1.80. Mailhamster (Mailsammler)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mailsystem.txt.html">1.81. Das eigene Mailsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="majordomo_postfix.txt.html">1.82. Majordomo Postfix</a></li>
<li class="toctree-l2"><a class="reference internal" href="make.conf_optimieren.txt.html">1.83. make.conf optimieren</a></li>
<li class="toctree-l2"><a class="reference internal" href="make_world.txt.html">1.84. make world</a></li>
<li class="toctree-l2"><a class="reference internal" href="mehrmonitor-betrieb.txt.html">1.85. Mehrmonitor-Betrieb</a></li>
<li class="toctree-l2"><a class="reference internal" href="mkisofs_und_cdrecord.txt.html">1.86. mkisofs und cdrecord</a></li>
<li class="toctree-l2"><a class="reference internal" href="mounten_als_benutzer.txt.html">1.87. Mounten als Benutzer</a></li>
<li class="toctree-l2"><a class="reference internal" href="moused_einrichten.txt.html">1.88. moused einrichten</a></li>
<li class="toctree-l2"><a class="reference internal" href="mozilla_mit_java-_und_flashsupport.txt.html">1.89. Mozilla mit Java- und Flashsupport</a></li>
<li class="toctree-l2"><a class="reference internal" href="mpd_einrichten.txt.html">1.90. MPD einrichten</a></li>
<li class="toctree-l2"><a class="reference internal" href="mpi.txt.html">1.91. MPI auf FreeBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="multihead_mit_nv.txt.html">1.92. Multihead mit nv</a></li>
<li class="toctree-l2"><a class="reference internal" href="nvidia_twinview.txt.html">1.93. nVidia Twinview</a></li>
<li class="toctree-l2"><a class="reference internal" href="openbsd_raspberry4_installieren.txt.html">1.94. OpenBSD 6.7 auf dem RaspberryPI 4 installieren</a></li>
<li class="toctree-l2"><a class="reference internal" href="openoffice_unter_freebsd.txt.html">1.95. OpenOffice unter FreeBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="openvpn_als_tunnel_zum_eigenen_netzwerk.txt.html">1.96. OpenVPN als Tunnel zum eigenen Netzwerk</a></li>
<li class="toctree-l2"><a class="reference internal" href="pakete_deinstallieren.txt.html">1.97. Pakete deinstallieren</a></li>
<li class="toctree-l2"><a class="reference internal" href="paketsysteme.txt.html">1.98. Paketsysteme</a></li>
<li class="toctree-l2"><a class="reference internal" href="partitionierung.txt.html">1.99. Festplattenpartitionierung unter FreeBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="pkg.txt.html">1.100. pkg</a></li>
<li class="toctree-l2"><a class="reference internal" href="postfix_antivirus.txt.html">1.101. Postfix Antivirus</a></li>
<li class="toctree-l2"><a class="reference internal" href="postfix_courier_openldap.txt.html">1.102. Postfix Courier OpenLDAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="postfix_dspam.txt.html">1.103. Postfix DSPAM</a></li>
<li class="toctree-l2"><a class="reference internal" href="postgresql_update.txt.html">1.104. PostgreSQL Update auf einen neueren Zweig</a></li>
<li class="toctree-l2"><a class="reference internal" href="poudriere.txt.html">1.105. Poudriere</a></li>
<li class="toctree-l2"><a class="reference internal" href="poudriere_guide.txt.html">1.106. Poudriere Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="putty.txt.html">1.107. PuTTY</a></li>
<li class="toctree-l2"><a class="reference internal" href="remount_rw.txt.html">1.108. Remount RW Read/Write</a></li>
<li class="toctree-l2"><a class="reference internal" href="revision_control_system.txt.html">1.109. Revision Control System</a></li>
<li class="toctree-l2"><a class="reference internal" href="runit.txt.html">1.110. runit auf FreeBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="samsung_smt_7020s.txt.html">1.111. Samsung SMT-7020S</a></li>
<li class="toctree-l2"><a class="reference internal" href="scharfe_windows_schriften.txt.html">1.112. scharfe Windows Schriften</a></li>
<li class="toctree-l2"><a class="reference internal" href="schoene_schriften_in_xorg.txt.html">1.113. Schöne Schriften in Xorg</a></li>
<li class="toctree-l2"><a class="reference internal" href="shell-scripting.txt.html">1.114. Shell-Scripting</a></li>
<li class="toctree-l2"><a class="reference internal" href="soundkarte_einrichten.txt.html">1.115. Soundkarte einrichten</a></li>
<li class="toctree-l2"><a class="reference internal" href="speaker_deaktivieren.txt.html">1.116. PC-Speaker deaktivieren</a></li>
<li class="toctree-l2"><a class="reference internal" href="ssh.txt.html">1.117. ssh</a></li>
<li class="toctree-l2"><a class="reference internal" href="strato_mr2_openbsd.txt.html">1.118. Strato MR2 (OpenBSD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="suspend_resume_thinkpad.txt.html">1.119. Suspend und Resume bei Thinkpads</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_in_raid1_verwandeln.txt.html">1.120. System in RAID1 verwandeln</a></li>
<li class="toctree-l2"><a class="reference internal" href="systemueberwachung.txt.html">1.121. Systemüberwachung</a></li>
<li class="toctree-l2"><a class="reference internal" href="texlive_aus_den_quellen.txt.html">1.122. TeXlive aus dem Quellcode installieren</a></li>
<li class="toctree-l2"><a class="reference internal" href="tomcat_6_installation_und_stolpersteine.txt.html">1.123. Tomcat 6 Installation und Stolpersteine</a></li>
<li class="toctree-l2"><a class="reference internal" href="tor.txt.html">1.124. Tor (OpenBSD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="tor_und_privoxy.txt.html">1.125. Tor und Privoxy</a></li>
<li class="toctree-l2"><a class="reference internal" href="tortoise-like_svn_menu_in_nautilus_mit_rabbitcvs.txt.html">1.126. Tortoise like SVN Menu in Nautilus</a></li>
<li class="toctree-l2"><a class="reference internal" href="tv-karte_benutzen.txt.html">1.127. TV-Karte benutzen</a></li>
<li class="toctree-l2"><a class="reference internal" href="twinview_mit_nvidia.txt.html">1.128. TwinView mit dem nVidia-Treiber für FreeBSD, Linux und Solaris</a></li>
<li class="toctree-l2"><a class="reference internal" href="umts.txt.html">1.129. UMTS</a></li>
<li class="toctree-l2"><a class="reference internal" href="umts_mit_huawei.txt.html">1.130. UMTS mit HUAWEI</a></li>
<li class="toctree-l2"><a class="reference internal" href="umts_mit_sunrise_und_swisscom.txt.html">1.131. UMTS mit Sunrise und Swisscom</a></li>
<li class="toctree-l2"><a class="reference internal" href="unicode.txt.html">1.132. UNICODE</a></li>
<li class="toctree-l2"><a class="reference internal" href="unicode_auf_der_konsole.txt.html">1.133. Unicode auf der Konsole</a></li>
<li class="toctree-l2"><a class="reference internal" href="unix-freigabe.txt.html">1.134. Unix-Freigabe</a></li>
<li class="toctree-l2"><a class="reference internal" href="updaten_von_openbsd.txt.html">1.135. Updaten von OpenBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="usb-stick_als_system-laufwerk_nutzen_mit_netbsd_livekey.txt.html">1.136. USB-Stick als System-Laufwerk nutzen mit „NetBSD LiveKey“</a></li>
<li class="toctree-l2"><a class="reference internal" href="usb-stick_bootfaehig_machen_openbsd.txt.html">1.137. USB-Stick bootfähig machen (OpenBSD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="usb-stick_installation.txt.html">1.138. USB-Stick Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="usb-stick_unterstuetzung.txt.html">1.139. USB-Stick Unterstützung</a></li>
<li class="toctree-l2"><a class="reference internal" href="usb_automount_ohne_hal.txt.html">1.140. USB Automount ohne HAL</a></li>
<li class="toctree-l2"><a class="reference internal" href="vdsl_mit_openbsd.txt.html">1.141. VDSL and OpenBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="vlans_mit_freebsd.txt.html">1.142. VLAN-Konfiguration mit FreeBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="vpn_openbsd.txt.html">1.143. VPN (OpenBSD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="windowmanager.txt.html">1.144. Windowmanager</a></li>
<li class="toctree-l2"><a class="reference internal" href="windows-freigabe.txt.html">1.145. Windows-Freigabe</a></li>
<li class="toctree-l2"><a class="reference internal" href="wine.txt.html">1.146. Wine</a></li>
<li class="toctree-l2"><a class="reference internal" href="xfce4_mit_gdm.txt.html">1.147. Xfce4 mit gdm</a></li>
<li class="toctree-l2"><a class="reference internal" href="xmodmap.txt.html">1.148. Xmodmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="xorg_config.txt.html">1.149. Xorg Konfigurieren</a></li>
<li class="toctree-l2"><a class="reference internal" href="zeit_synchronisieren_mit_ntp.txt.html">1.150. Zeit synchronisieren mit ntp</a></li>
<li class="toctree-l2"><a class="reference internal" href="zfs.txt.html">1.151. ZFS auf FreeBSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="zfs_geli_und_usb_boot.txt.html">1.152. ZFS (raidz), Geli und USB Boot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../anwendungen/anwendungen_index.html">2. Anwendungen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hardware/hardware_index.html">3. Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spiele/spiele_index.html">4. Spiele</a></li>
<li class="toctree-l1"><a class="reference internal" href="../freebsd/freebsd_index.html">5. FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../openbsd/openbsd_index.html">6. OpenBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netbsd/netbsd_index.html">7. NetBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dragonflybsd/dragonflybsd_index.html">8. DragonFlyBSD</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BSDForen.de</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="howto_index.html"><span class="section-number">1. </span>Howto</a> &raquo;</li>
        
      <li><span class="section-number">1.65. </span>IPSEC-VPN</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/howto/ipsec-vpn.txt.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="ipv6_netzwerke.txt.html" class="btn btn-neutral float-right" title="1.66. IPv6-Netzwerke mit FreeBSD als Router" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="intel2200bg.txt.html" class="btn btn-neutral float-left" title="1.64. Intel 2200BG" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ipsec-vpn">
<h1><span class="section-number">1.65. </span>IPSEC-VPN<a class="headerlink" href="#ipsec-vpn" title="Link zu dieser Überschrift">¶</a></h1>
<div class="sidebar">
<p class="sidebar-title">Info</p>
<img alt="../_images/logo-freebsd3.png" src="../_images/logo-freebsd3.png" />
</div>
<p>Dieser Artikel ist noch recht jung und vermutlich sehr auf den Aufbau des
Autors zugeschnitten, trotzdem hoffe ich, dass dieser Artikel jemandem die
nötigen Denkanstösse liefern kann.</p>
<div class="section" id="versuchsaufbau">
<h2><span class="section-number">1.65.1. </span>Versuchsaufbau<a class="headerlink" href="#versuchsaufbau" title="Link zu dieser Überschrift">¶</a></h2>
<p>In diesem Artikel wird davon ausgegangen, dass auf beiden Seiten fixe
IP-Adressen verfügbar sind. In beiden Netzen steht ein Gateway Rechner,
der auf einem Interface mit einer öffentlichen IP-Adresse mit dem
Internet verbunden ist und mit einem zweiten Interface mit einer
RFC1918-Adresse mit dem internen Netz verbunden ist. Diese Rechner sind
auf beiden Seiten auch für die Paketfilterung und für NAT zuständig.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 35%" />
<col style="width: 15%" />
<col style="width: 35%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Netz A:</strong></p></th>
<th class="head"></th>
<th class="head"><p><strong>Netz B:</strong></p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Interne Netzadresse:</p></td>
<td><p>192.168.0.0/24</p></td>
<td><p>Interne Netzadresse:</p></td>
<td><p>192.168.1.0/24</p></td>
</tr>
<tr class="row-odd"><td><p>Interne IP-Adresse des Gateways:</p></td>
<td><p>192.168.0.1</p></td>
<td><p>Interne IP-Adresse des Gateways:</p></td>
<td><p>192.168.1.1</p></td>
</tr>
<tr class="row-even"><td><p>Externe IP-Adresse des Gateways:</p></td>
<td><p>194.1.1.1</p></td>
<td><p>Externe IP-Adresse des Gateways:</p></td>
<td><p>62.2.2.2</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ipsec-einrichtung">
<h2><span class="section-number">1.65.2. </span>IPSEC-Einrichtung<a class="headerlink" href="#ipsec-einrichtung" title="Link zu dieser Überschrift">¶</a></h2>
<div class="section" id="aktivieren-von-ipsec-im-kernel">
<h3><span class="section-number">1.65.2.1. </span>Aktivieren von IPSec im Kernel<a class="headerlink" href="#aktivieren-von-ipsec-im-kernel" title="Link zu dieser Überschrift">¶</a></h3>
<p>Zuerst sollte man ueberprüfen, ob IPSec im Kernel aktiviert ist. Das
kann man mit Hilfe von sysctl ueberprüfen. Folgendes sollte bei
folgender Eingabe erscheinen:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sysctl net.inet.ipsec

net.inet.ipsec.esp_trans_deflev: 1 net.inet.ipsec.esp_net_deflev: 1
net.inet.ipsec.ah_trans_deflev: 1 net.inet.ipsec.ah_net_deflev: 1
net.inet.ipsec.ah_cleartos: 1 net.inet.ipsec.ah_offsetmask: 0
net.inet.ipsec.dfbit: 0 net.inet.ipsec.ecn: 0 net.inet.ipsec.debug: 0
net.inet.ipsec.esp_randpad: -1
</pre></div>
</div>
<p>Bekommt man nur die Meldung <strong>sysctl: unknown oid net.inet.ipsec</strong> und
bringt ein Aufruf von <strong>setkey -v</strong> ein <strong>pfkey_open: Protocol not
Supported</strong>, dann ist IPSec nicht im Kernel aktiviert.</p>
<p>Hierzu muss man folgendes im Kernel hinzufügen:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">options</span>   <span class="n">IPSEC</span>        <span class="c1">#IP security</span>
<span class="n">options</span>   <span class="n">IPSEC_ESP</span>    <span class="c1">#IP security (crypto; define w/ IPSEC)</span>
</pre></div>
</div>
<p>Optional kann man fuers Debuggen noch folgendes im Kernel hinzufuegen:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">options</span>   <span class="n">IPSEC_DEBUG</span>  <span class="c1">#debug for IP security</span>
</pre></div>
</div>
<p>Nach dem Installieren des Kernels und Restarten des Systems sollte IPSec
im Kernel aktiviert sein.</p>
<p>Weitere Informationen findet man im FreeBSD Handbuch
<a class="reference external" href="http://www.de.freebsd.org/doc/de_DE.ISO8859-1/books/handbook/ipsec.html">http://www.de.freebsd.org/doc/de_DE.ISO8859-1/books/handbook/ipsec.html</a></p>
<div class="admonition warning">
<p class="admonition-title">Warnung</p>
<p><strong>FreeBSD 6.1</strong>: Leider ist IPSec weder im GENERIC Kernel aktiviert, noch
gibt es einen Hinweis in der Datei <strong>src/sys/i386/conf/NOTES</strong>. Selbst ein
<strong>man ipsec</strong> läßt sich nicht über die Kernel-Optionen IPSEC aus. Es ist aber
wichtig das diese im Kernel hinzugefügt werden.</p>
</div>
</div>
</div>
<div class="section" id="einstellungen-im-basissytem">
<h2><span class="section-number">1.65.3. </span>Einstellungen im Basissytem<a class="headerlink" href="#einstellungen-im-basissytem" title="Link zu dieser Überschrift">¶</a></h2>
<div class="section" id="etc-rc-conf">
<h3><span class="section-number">1.65.3.1. </span>/etc/rc.conf<a class="headerlink" href="#etc-rc-conf" title="Link zu dieser Überschrift">¶</a></h3>
<p>Auf dem Gateway von Netz A (192.168.0.0/24):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gif_interfaces</span><span class="o">=</span><span class="s2">&quot;gif0&quot;</span>
<span class="n">gifconfig_gif0</span><span class="o">=</span><span class="s2">&quot;194.1.1.1 62.2.2.2&quot;</span>
<span class="n">ifconfig_gif0</span><span class="o">=</span><span class="s2">&quot;inet 192.168.0.1 192.168.1.1 netmask 0xffffffff&quot;</span>
<span class="n">ipsec_enable</span><span class="o">=</span><span class="s2">&quot;YES&quot;</span>              <span class="c1"># Enable IPSEC at system start</span>
<span class="n">ipsec_file</span><span class="o">=</span><span class="s2">&quot;/etc/ipsec.conf&quot;</span>    <span class="c1"># Policy rules for IPSEC</span>
<span class="n">static_routes</span><span class="o">=</span><span class="s2">&quot;ipsectob&quot;</span>        <span class="c1"># Static routes for IPSEC</span>
<span class="n">route_ipsectob</span><span class="o">=</span><span class="s2">&quot;-net 192.168.1.0/24 192.168.1.1&quot;</span>
</pre></div>
</div>
<p>Auf dem Gateway von Netz B (192.168.1.0/24):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gif_interfaces</span><span class="o">=</span><span class="s2">&quot;gif0&quot;</span>
<span class="n">gifconfig_gif0</span><span class="o">=</span><span class="s2">&quot;62.2.2.2 194.1.1.1&quot;</span>
<span class="n">ifconfig_gif0</span><span class="o">=</span><span class="s2">&quot;inet 192.168.1.1 192.168.0.1 netmask 0xffffffff&quot;</span>
<span class="n">ipsec_enable</span><span class="o">=</span><span class="s2">&quot;YES&quot;</span>              <span class="c1"># Enable IPSEC at system start</span>
<span class="n">ipsec_file</span><span class="o">=</span><span class="s2">&quot;/etc/ipsec.conf&quot;</span>    <span class="c1"># Policy rules for IPSEC</span>
<span class="n">static_routes</span><span class="o">=</span><span class="s2">&quot;ipsectoa&quot;</span>        <span class="c1"># Static routes for IPSEC</span>
<span class="n">route_ipsectoa</span><span class="o">=</span><span class="s2">&quot;-net 192.168.0.0/24 192.168.0.1&quot;</span>
</pre></div>
</div>
<p><strong>gif_interfaces</strong>, <strong>gifconfig_gif0</strong> und <strong>ifconfig_gif0</strong> erzeugen
beim Systemstart die nötigen ifconfig-Aufrufe, die den Tunnel festlegen.
Die <code class="docutils literal notranslate"><span class="pre">ipsec_*</span></code>-Einträge sorgen dafür, daß die nötigen Kommandos
ausgeführt werden, die den Tunnel-Traffic auch verschlüsseln (spadd) und
die Einträge für die Routen erzeugen beim Systemstart die nötige
statische Route zum jeweils anderen Tunnel-Endpunkt.</p>
</div>
<div class="section" id="etc-ipsec-conf">
<h3><span class="section-number">1.65.3.2. </span>/etc/ipsec.conf<a class="headerlink" href="#etc-ipsec-conf" title="Link zu dieser Überschrift">¶</a></h3>
<p>Die Datei <strong>/etc/ipsec.conf</strong> konfiguriert den Tunnel und legt fest,
welcher Verkehr verschlüsselt durch den Tunnel muß:</p>
<p>Auf dem Gateway von Netz A (192.168.0.0/24):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spdadd</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">24</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span> <span class="nb">any</span> <span class="o">-</span><span class="n">P</span> <span class="n">out</span> \
  <span class="n">ipsec</span> <span class="n">esp</span><span class="o">/</span><span class="n">tunnel</span><span class="o">/</span><span class="mf">194.1</span><span class="o">.</span><span class="mf">1.1</span><span class="o">-</span><span class="mf">62.2</span><span class="o">.</span><span class="mf">2.2</span><span class="o">/</span><span class="n">require</span><span class="p">;</span>
<span class="n">spdadd</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">24</span> <span class="nb">any</span> <span class="o">-</span><span class="n">P</span> <span class="ow">in</span> \
  <span class="n">ipsec</span> <span class="n">esp</span><span class="o">/</span><span class="n">tunnel</span><span class="o">/</span><span class="mf">62.2</span><span class="o">.</span><span class="mf">2.2</span><span class="o">-</span><span class="mf">194.1</span><span class="o">.</span><span class="mf">1.1</span><span class="o">/</span><span class="n">require</span><span class="p">;</span>
</pre></div>
</div>
<p>Auf dem Gateway von Netz B (192.168.1.0/24):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spdadd</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">24</span> <span class="nb">any</span> <span class="o">-</span><span class="n">P</span> <span class="n">out</span> \
  <span class="n">ipsec</span> <span class="n">esp</span><span class="o">/</span><span class="n">tunnel</span><span class="o">/</span><span class="mf">62.2</span><span class="o">.</span><span class="mf">2.2</span><span class="o">-</span><span class="mf">194.1</span><span class="o">.</span><span class="mf">1.1</span><span class="o">/</span><span class="n">require</span><span class="p">;</span>
<span class="n">spdadd</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">24</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span> <span class="nb">any</span> <span class="o">-</span><span class="n">P</span> <span class="ow">in</span> \
  <span class="n">ipsec</span> <span class="n">esp</span><span class="o">/</span><span class="n">tunnel</span><span class="o">/</span><span class="mf">194.1</span><span class="o">.</span><span class="mf">1.1</span><span class="o">-</span><span class="mf">62.2</span><span class="o">.</span><span class="mf">2.2</span><span class="o">/</span><span class="n">require</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="racoon">
<h3><span class="section-number">1.65.3.3. </span>Racoon<a class="headerlink" href="#racoon" title="Link zu dieser Überschrift">¶</a></h3>
<p>Racoon ist im Port
<a class="reference external" href="https://www.google.com/search?q=security/ipsec-tools&amp;btnI=lucky">security/ipsec-tools</a>
enthalten und handelt zwischen den beteiligten Gateways die nötigen
Informationen für die Authentifizierung und Verschlüsselung aus. In
diesem Beispiel wird ein pre-shared-key verwendet. Im
<strong>Listen</strong>-Abschnitt muß man in der Zeile mit <strong>isakmp $Öffentliche-IP
[500];</strong> anstelle von <strong>$Öffentliche-IP</strong> wirklich die IP-Adresse
einsetzen und die <strong>*_identifier</strong>-Einträge sollten jeweils die E-Mail
Adresse einer Kontaktperson enthalten.</p>
</div>
<div class="section" id="usr-local-etc-racoon-racoon-conf">
<h3><span class="section-number">1.65.3.4. </span>/usr/local/etc/racoon/racoon.conf<a class="headerlink" href="#usr-local-etc-racoon-racoon-conf" title="Link zu dieser Überschrift">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># $KAME: racoon.conf.in,v 1.18 2001/08/16 06:33:40 itojun Exp $

# &quot;path&quot; must be placed before it should be used.
# You can overwrite which you defined, but it should not use due to confusing.
path include &quot;/usr/local/etc/racoon&quot; ;
#include &quot;remote.conf&quot; ;

# search this file for pre_shared_key with various ID key.
path pre_shared_key &quot;/usr/local/etc/racoon/psk.txt&quot; ;

# racoon will look for certificate file in the directory,
# if the certificate/certificate request payload is received.
path certificate &quot;/usr/local/etc/cert&quot; ;

# &quot;padding&quot; defines some parameter of padding.  You should not touch these.
padding
{
        maximum_length 20;      # maximum padding length.
        randomize off;          # enable randomize length.
        strict_check off;       # enable strict check.
        exclusive_tail off;     # extract last one octet.
}

# if no listen directive is specified, racoon will listen to all
# available interface addresses.
listen
{
        #isakmp ::1 [7000];
        #isakmp 202.249.11.124 [500];
        #admin [7002];          # administrative&#39;s port by kmpstat.
        #strict_address;        # required all addresses must be bound.
        isakmp $Öffentliche-IP [500];
}

# Specification of default various timer.
timer
{
        # These value can be changed per remote node.
        counter 5;              # maximum trying count to send.
        interval 40 sec;        # maximum interval to resend.
        persend 1;              # the number of packets per a send.

        # timer for waiting to complete each phase.
        phase1 50 sec;
        phase2 30 sec;
}

remote anonymous
{
        #exchange_mode main,aggressive;
        exchange_mode aggressive,main;
        doi ipsec_doi;
        situation identity_only;

        #my_identifier address;
        my_identifier user_fqdn &quot;kontaktperson@netza.local&quot;;
        peers_identifier user_fqdn &quot;kontaktperson@netza.local&quot;;
        #certificate_type x509 &quot;mycert&quot; &quot;mypriv&quot;;

        nonce_size 16;
        lifetime time 1 hour;   # sec,min,hour
        initial_contact on;
        #support_mip6 on;
        support_proxy on;
        proposal_check obey;    # obey, strict or claim

        proposal {
                encryption_algorithm 3des;
                hash_algorithm sha1;
                authentication_method pre_shared_key ;
                dh_group 2 ;
        }
}

sainfo anonymous
{
        pfs_group 1;
        lifetime time 30 sec;
        encryption_algorithm 3des ;
        authentication_algorithm hmac_sha1;
        compression_algorithm deflate ;
}
</pre></div>
</div>
</div>
<div class="section" id="usr-local-etc-racoon-psk-txt">
<h3><span class="section-number">1.65.3.5. </span>/usr/local/etc/racoon/psk.txt<a class="headerlink" href="#usr-local-etc-racoon-psk-txt" title="Link zu dieser Überschrift">¶</a></h3>
<p>Auf dem Gateway von Netz A (192.168.0.0/24):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>62.2.2.2   sfkjh%I-ZO§gLKabf
</pre></div>
</div>
<p>Auf dem Gateway von Netz B (192.168.1.0/24):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>194.1.1.1   sfkjh%I-ZO§gLKabf
</pre></div>
</div>
</div>
</div>
<div class="section" id="paketfilter-konfiguration">
<h2><span class="section-number">1.65.4. </span>Paketfilter-Konfiguration<a class="headerlink" href="#paketfilter-konfiguration" title="Link zu dieser Überschrift">¶</a></h2>
<p>Im Beispiel wird als Paketfilter IPFW mit divert (natd) verwendet. Es
ist unbedingt darauf zu achten, dass Traffic für den IPSEC-Tunnel
<strong>nicht</strong> auf eine divert-Regel (NAT) treffen darf (jedenfalls gelang es
dem Autor nicht, Traffic durch den Tunnel zu bekommen, wenn die Pakete
auf die divert-Regel trafen).</p>
<div class="section" id="einstellungen-im-basissystem">
<h3><span class="section-number">1.65.4.1. </span>Einstellungen im Basissystem<a class="headerlink" href="#einstellungen-im-basissystem" title="Link zu dieser Überschrift">¶</a></h3>
</div>
<div class="section" id="etcrc-conf-1">
<span id="id1"></span><h3><span class="section-number">1.65.4.2. </span>/etc/rc.conf<a class="headerlink" href="#etcrc-conf-1" title="Link zu dieser Überschrift">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">natd_enable</span><span class="o">=</span><span class="s2">&quot;YES&quot;</span>               <span class="c1"># Enable natd for Port Adress Translation</span>
<span class="n">natd_interface</span><span class="o">=</span><span class="s2">&quot;tun0&quot;</span>
<span class="n">natd_flags</span><span class="o">=</span><span class="s2">&quot;-f /etc/natd.conf&quot;</span>
<span class="n">firewall_enable</span><span class="o">=</span><span class="s2">&quot;YES&quot;</span>           <span class="c1"># Enable packet filtering</span>
<span class="n">firewall_script</span><span class="o">=</span><span class="s2">&quot;/etc/ipfw.conf&quot;</span>
<span class="n">gateway_enable</span><span class="o">=</span><span class="s2">&quot;YES&quot;</span>            <span class="c1"># Enable routing</span>
</pre></div>
</div>
</div>
<div class="section" id="etc-natd-conf">
<h3><span class="section-number">1.65.4.3. </span>/etc/natd.conf<a class="headerlink" href="#etc-natd-conf" title="Link zu dieser Überschrift">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">use_sockets</span> <span class="n">yes</span>
<span class="n">same_ports</span> <span class="n">yes</span>
<span class="n">unregistered_only</span> <span class="n">yes</span>
<span class="n">dynamic</span> <span class="n">yes</span>
<span class="n">interface</span> <span class="n">tun0</span>
</pre></div>
</div>
</div>
<div class="section" id="etc-ipfw-conf">
<h3><span class="section-number">1.65.4.4. </span>/etc/ipfw.conf<a class="headerlink" href="#etc-ipfw-conf" title="Link zu dieser Überschrift">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warnung</p>
<p>Bitte beachten, daß dieses Regelwerk keinesfalls vollständig ist und unter
keinen Umständen in genau dieser Form verwendet werden soll. Es soll nur
verdeutlichen, welche Regeln man wo setzen muß, damit der IPSEC-Traffic
ordnungsgemäß durch den Tunnel geleitet wird.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/sh

# Define the firewall command
fwcmd=&quot;/sbin/ipfw&quot;
# Define variables
dsl=&quot;tun0&quot;
extif=&quot;ed0&quot;
intif=&quot;rl0&quot;
myip=&quot;192.168.0.1/32&quot;
trusted=&quot;192.168.0.0/24&quot;
trustedremote=&quot;192.168.1.0/24&quot;

# Force a flushing of the current rules before we reload
${fwcmd} -f flush

# Allow IPSEC
${fwcmd} add allow udp from any to any isakmp via ${dsl} // ISAKMP
${fwcmd} add allow esp from any to any via ${dsl} // ESP

# IPSEC tunnel traffic
${fwcmd} add allow icmp from ${trusted} to ${trustedremote}
${fwcmd} add allow icmp from ${trustedremote} to ${trusted}
${fwcmd} add reset all from ${trustedremote} to ${trusted} dst-port 135,137,138,139,445 // block SMB
${fwcmd} add reset all from ${trusted} to ${trustedremote} dst-port 135,137,138,139,445 // block SMB
${fwcmd} add allow tcp from ${trusted} to ${trustedremote} dst-port telnet // allow telnet
${fwcmd} add allow tcp from ${trustedremote} to ${trusted} src-port telnet // allow telnet
${fwcmd} add allow tcp from ${trusted} to ${trustedremote} dst-port rdp // allow RDP
${fwcmd} add allow tcp from ${trustedremote} to ${trusted} src-port rdp // allow RDP
# Block the rest, be polite
${fwcmd} add unreach port udp from ${trustedremote} to ${trusted}
${fwcmd} add unreach port udp from ${trusted} to ${trustedremote}
${fwcmd} add reset all from ${trustedremote} to ${trusted}
${fwcmd} add reset all from ${trusted} to ${trustedremote}

# divert for NAT
${fwcmd} add divert natd all from any to any via ${dsl}

# check state for dynamic rules
${fwcmd} add check-state

# external interface (extif)
# allow everything between external interface and modem
${fwcmd} add allow all from any to any via ${extif}

# PPPoE interface (ext)
# allow icmp
${fwcmd} add allow icmp from any to any via ${dsl}

# reject critical Microsoft ports
${fwcmd} add reset all from any to me dst-port 135,137,138,139,445,5000 in recv ${dsl}

# allow special protocols in
${fwcmd} add allow tcp from any to me dst-port https in via ${dsl} keep-state // https

# reject NetBIOS traffic trying to leave my network
${fwcmd} add reset all from any to any src-port 135,137,138,139,445 out xmit ${dsl}

# let everything else out
${fwcmd} add allow all from any to any out xmit ${dsl} keep-state

# reject the rest
${fwcmd} add reset all from any to me in via ${dsl} setup keep-state

# internal interface (int)
# allow everything from internal network
${fwcmd} add allow all from any to any via ${intif} keep-state

# loopback interface
# allow everything
${fwcmd} add allow all from any to any via lo0

# default: reject everything
${fwcmd} add unreach port udp from any to any
${fwcmd} add reset all from any to any
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference internal" href="../genindex.html"><span class="std std-ref">Stichwortverzeichnis</span></a></p></li>
</ul>
<p>Zuletzt geändert: 2020-10-27</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ipv6_netzwerke.txt.html" class="btn btn-neutral float-right" title="1.66. IPv6-Netzwerke mit FreeBSD als Router" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="intel2200bg.txt.html" class="btn btn-neutral float-left" title="1.64. Intel 2200BG" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, BSDForen.de

    </p>
  </div>
    
    
      Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>